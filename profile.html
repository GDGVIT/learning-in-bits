<!DOCTYPE html>
<html>

<head>
	<title>Profile</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, height=device-height" />
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.0/css/bootstrap.min.css"
		integrity="sha384-PDle/QlgIONtM1aqA2Qemk5gPOE7wFq8+Em+G/hmo5Iq0CCmYZLv3fVRDJ4MMwEA" crossorigin="anonymous">
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css"
		integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
	<link href="https://fonts.googleapis.com/css?family=Quicksand" rel="stylesheet">
	<script src="https://cdn.jsdelivr.net/npm/js-cookie@2/src/js.cookie.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
	<script type="text/javascript" src="assets/js/lib/jquery-2.2.4.min.js"></script>
	<link rel="stylesheet" type="text/css" href="profile.css">
</head>

<body>
	<div class="container">
		<div class="row">
			<div class="col-4">
				<div class="img">
					<img class="img-responsive" src="Assets/learninginbits.svg">
				</div>
			</div>
		</div>
		<div class="profile">
			<div class="row">
				<div class="col-7"></div>
				<div class="col-2">
					<img class="Person" src="Assets/Person Image.png">
					<!-- <img class="Person1" src="Assets/Ellipse3.png">
			<img class="Person2" src="Assets/Ellipse3@2x.png">
			<img class="Person3" src="Assets/Ellipse3@3x.png"> -->

				</div>
				<!-- <div class="col-5"></div> -->
			</div>
			<div class="details">
				<i class='fa fa-pen'></i>
				<div>
					<p class="name" id="name"></p>
					<div class="edit">
						<input type="text" placeholder="" id="fullname">
					</div>
					<p class="subscript">Full name</p>

				</div>
				<div>
					<p class="email" id="email"></p>
					<div class="edit">
						<input type="text" placeholder="" id="email">
					</div>
					<p class="subscript">Email</p>


				</div>
				<div>
					<p class="password" style="visibility:hidden;">Password</p>
					<div class="edit">
						<input type="password" placeholder="Confirm password" id="confirmpass">
					</div>
					<div class="edit">
						<input type="password" placeholder="New password" id="newpass">
					</div>
					<div class="edit_last">
						<input type="password" placeholder="Confirm new password" id="confirmnewpass">
					</div>

					<p class="subscript" style="display:none;">Password</p>


				</div>
				<div>
					<a href="quotepage.html" style="text-decoration: none">
						<p class="interests" id="tags"></p>
						<p class="subscript">Interests</p>
						<p class="subscript" style="padding:10px; font-size: 0.5em;"> Click to see a new quote</p>
					</a>
				</div>

				<a href="index.html" style="text-decoration: none">
					<button class="bt"> Log Out </button>
				</a>
			</div>
		</div>

	</div>

	<script src="profile.js"></script>
	<!-- <script src="Assets/js/index.js"></script> -->
	<script>
		let ob = {}
		$(document).ready(function () {
			//Ajax to pass token as page loads
			$.ajax({
				url: 'https://stark-retreat-48003.herokuapp.com/view_profile',
				type: 'POST',
				data: JSON.stringify({
					"token": Cookies.get("token")
				}),
				contentType: 'application/json',
				dataType: 'json',
				crossDomain: true,
				crossOrigin: true,
				headers: {
					"accept": "application/json",
					"Access-Control-Allow-Origin": "*"
				},
				success: (msg) => {

					console.log(msg)
					// console.log(document.cookie)
					$("#name").append(msg.fullname)
					$("#email").append(msg.email)
					if (msg.tags[0] === "[]") {
						msg.tags.shift();
						$("#tags").append(','+msg.tags)
					}else{
						$("#tags").append(','+ msg.tags)
					}
					

				},
				error: (err) => {
					console.log(err)
				}
			})
			$(".details").on("click", ".fa-check", function (e) {
				// ob.token = Cookies.get("token")
				// ob.fullname = document.getElementById("fullname").value
				// ob.email = document.getElementById("email").value
				// ob.password = document.getElementById("confirmpass").value;
				// ob.new_password = document.getElementById("newpass").value;
				// ob.confirm_new_password = document.getElementById("confirmnewpass").value;

				$.ajax({
					url: 'https://stark-retreat-48003.herokuapp.com/edit_profile',
					type: 'POST',
					data: JSON.stringify({
						"token": Cookies.get("token"),
						"fullname":document.getElementById("fullname").value,
						"email": document.getElementById("email").value
					}),
					crossDomain: true,
					crossOrigin: true,
					headers: {
						"accept": "application/json",
						"Access-Control-Allow-Origin": "*"
					},
					contentType: 'application/json',
					success: function (msg) {
						// console.log('Updated')
						console.log(msg)
						// document.getElementById('name').innerHTML = update.fullname;
						// console.log(msg.fullname);

						// console.log(document.cookie)

					},
					error: function (err) {
						console.log(err)
					}

				})

				//forgot password
				$.ajax({
					url: 'https://stark-retreat-48003.herokuapp.com/edit_profile',
					type: 'POST',
					data: JSON.stringify({
						"username": document.getElementById("fullname").value,
						"password": document.getElementById("confirmpass").value,
						"new_password": document.getElementById("newpass").value,
						"confirm_new_password": document.getElementById("confirmnewpass")
							.value

					}),
					crossDomain: true,
					crossOrigin: true,
					headers: {
						"accept": "application/json",
						"Access-Control-Allow-Origin": "*"
					},
					contentType: 'application/json',
					success: function (msg) {
						console.log(msg)
					},
					error: function (err) {
						console.log(err)
					}

				})
			})
		})
	</script>

</body>

</html>